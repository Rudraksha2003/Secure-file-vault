<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Account — File Vault</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = { theme: { extend: { fontFamily: { sans: ['Outfit', 'system-ui', 'sans-serif'] } } } }
  </script>
  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet" />
  <link rel="stylesheet" href="css/style.css" />
  <script>(function(){var t=localStorage.getItem('theme');if(t!=='light'&&t!=='dark')t='dark';document.documentElement.classList.add(t==='light'?'theme-light':'theme-dark');})();</script>
</head>
<body class="min-h-screen bg-slate-950 text-slate-100 font-sans antialiased">
  <div class="max-w-2xl mx-auto px-4 sm:px-6 py-6 sm:py-12">
    <header class="flex flex-wrap items-center justify-between gap-3 mb-8 sm:mb-10">
      <h1 class="text-xl sm:text-2xl font-bold text-white">Account</h1>
      <div class="flex items-center gap-2">
        <a href="dashboard.html" class="rounded-xl border border-slate-600 px-4 py-3 sm:py-2 text-slate-400 text-sm transition hover:text-white hover:border-slate-500 touch-manipulation">
          Dashboard
        </a>
        <button
          onclick="logout()"
          class="rounded-xl border border-slate-600 px-4 py-3 sm:py-2 text-slate-400 text-sm transition hover:text-white hover:border-slate-500 touch-manipulation"
        >
          Logout
        </button>
      </div>
    </header>

    <div id="accountLoading" class="rounded-2xl border border-slate-800 bg-slate-900/50 p-8 text-center text-slate-400">
      Loading…
    </div>

    <div id="accountContent" class="hidden space-y-6">
      <!-- Profile / display name -->
      <section class="rounded-2xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-4 sm:p-8 shadow-xl">
        <h2 class="text-base sm:text-lg font-semibold text-white mb-4">Profile</h2>
        <div class="space-y-4">
          <div>
            <label for="accountEmail" class="block text-sm font-medium text-slate-300 mb-1">Email</label>
            <input
              type="email"
              id="accountEmail"
              readonly
              class="w-full rounded-xl border border-slate-600 bg-slate-800/50 px-4 py-3 text-slate-400 cursor-not-allowed"
            />
            <p class="mt-1 text-xs text-slate-500">Email is used to sign in. To change it, use the section below.</p>
          </div>
          <div>
            <label for="accountUsername" class="block text-sm font-medium text-slate-300 mb-1">Username</label>
            <input
              type="text"
              id="accountUsername"
              placeholder="Choose a username (for login)"
              maxlength="50"
              autocomplete="username"
              class="w-full rounded-xl border border-slate-600 bg-slate-800 px-4 py-3 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500 transition"
            />
            <p class="mt-1 text-xs text-slate-500">You can sign in with this username or your email. Must be unique.</p>
            <button type="button" id="saveUsernameBtn" class="mt-2 rounded-xl bg-amber-500 px-4 py-2 text-slate-900 text-sm font-medium transition hover:bg-amber-400">
              Save username
            </button>
            <p id="usernameMessage" class="mt-2 text-sm hidden"></p>
          </div>
        </div>
      </section>

      <!-- Change password -->
      <section class="rounded-2xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-4 sm:p-8 shadow-xl">
        <h2 class="text-base sm:text-lg font-semibold text-white mb-4">Change password</h2>
        <form id="passwordForm" class="space-y-4">
          <div>
            <label for="currentPassword" class="block text-sm font-medium text-slate-300 mb-1">Current password</label>
            <input
              type="password"
              id="currentPassword"
              placeholder="••••••••"
              class="w-full rounded-xl border border-slate-600 bg-slate-800 px-4 py-3 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500 transition"
            />
          </div>
          <div>
            <label for="newPassword" class="block text-sm font-medium text-slate-300 mb-1">New password</label>
            <input
              type="password"
              id="newPassword"
              placeholder="••••••••"
              minlength="6"
              class="w-full rounded-xl border border-slate-600 bg-slate-800 px-4 py-3 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500 transition"
            />
          </div>
          <div>
            <label for="newPasswordConfirm" class="block text-sm font-medium text-slate-300 mb-1">Confirm new password</label>
            <input
              type="password"
              id="newPasswordConfirm"
              placeholder="••••••••"
              minlength="6"
              class="w-full rounded-xl border border-slate-600 bg-slate-800 px-4 py-3 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500 transition"
            />
          </div>
          <button type="submit" id="savePasswordBtn" class="rounded-xl bg-amber-500 px-4 py-3 text-slate-900 font-medium transition hover:bg-amber-400">
            Update password
          </button>
          <p id="passwordMessage" class="mt-2 text-sm hidden"></p>
        </form>
      </section>

      <!-- Change email (with care) -->
      <section class="rounded-2xl border border-slate-800 bg-slate-900/50 backdrop-blur-sm p-4 sm:p-8 shadow-xl">
        <h2 class="text-base sm:text-lg font-semibold text-white mb-4">Change email</h2>
        <div class="rounded-lg border border-amber-500/30 bg-amber-500/10 p-3 mb-4 text-amber-200 text-sm">
          Changing your email will send confirmation links to both your current and new address. The change completes only after you confirm the new email. You will sign in with the new email afterward.
        </div>
        <form id="emailForm" class="space-y-4">
          <div>
            <label for="newEmail" class="block text-sm font-medium text-slate-300 mb-1">New email</label>
            <input
              type="email"
              id="newEmail"
              placeholder="new@example.com"
              maxlength="320"
              autocomplete="email"
              class="w-full rounded-xl border border-slate-600 bg-slate-800 px-4 py-3 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500 transition"
            />
          </div>
          <div>
            <label for="emailPassword" class="block text-sm font-medium text-slate-300 mb-1">Your password</label>
            <input
              type="password"
              id="emailPassword"
              placeholder="••••••••"
              class="w-full rounded-xl border border-slate-600 bg-slate-800 px-4 py-3 text-white placeholder-slate-500 focus:border-amber-500 focus:outline-none focus:ring-1 focus:ring-amber-500 transition"
            />
            <p class="mt-1 text-xs text-slate-500">Required to confirm the email change.</p>
          </div>
          <button type="submit" id="saveEmailBtn" class="rounded-xl bg-amber-500 px-4 py-3 text-slate-900 font-medium transition hover:bg-amber-400">
            Send email change confirmation
          </button>
          <p id="emailMessage" class="mt-2 text-sm hidden"></p>
        </form>
      </section>
    </div>

    <p class="mt-6 text-center pb-4">
      <a href="dashboard.html" class="text-slate-400 hover:text-white text-sm transition">← Back to dashboard</a>
    </p>
  </div>
  <script src="js/supabaseConfig.generated.js"></script>
  <script type="module" src="js/main.js"></script>
  <script type="module" src="js/account.js"></script>
  <script src="js/theme.js"></script>
</body>
</html>
